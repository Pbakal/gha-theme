{{ define "main" }}

<div class="h-screen w-full overflow-y-scroll snap-y snap-mandatory scroll-smooth no-scrollbar md:h-auto md:overflow-visible md:snap-none md:pt-24 md:pb-0">
  
  <header class="hidden md:flex items-end justify-between mb-10 border-b border-gray-200 pb-6 max-w-7xl mx-auto px-6">
    <div>
      <h1 class="text-5xl font-black text-text-main tracking-tight mb-2">Top Stories</h1>
      <p class="text-gray-500">The most important news selected for you.</p>
    </div>
    <span class="text-sm font-medium text-brand uppercase tracking-wider">
        <span class="text-sm text-gray-700 lowercase">Last from </span>{{ .Site.Params.city }}
    </span>
  </header>

  <div class="contents md:grid md:grid-cols-2 lg:grid-cols-3 md:gap-8 lg:gap-10 md:max-w-7xl md:mx-auto md:px-6">
    
    {{ $paginator := .Paginate (where .Site.RegularPages "Section" "posts") }}

    {{ range $index, $element := $paginator.Pages }}

    <article class="group relative w-full h-screen snap-start shrink-0 flex flex-col justify-end md:h-auto md:snap-align-none md:block md:bg-transparent md:justify-start">
      
      <div class="absolute inset-0 z-0 overflow-hidden md:relative md:aspect-[4/3] md:rounded-2xl md:shadow-lg">
        
        {{ $imgResource := .Resources.GetMatch .Site.Params.images.priority_pattern }}
        {{ if not $imgResource }}
            {{ $imgResource = .Resources.GetMatch .Site.Params.images.fallback_pattern }}
        {{ end }}

        {{ with $imgResource }} 
            {{ $mobileImg := .Fill "800x1200 webp center" }}
            {{ $desktopImg := .Fill "1200x675 webp center" }} 
            
            {{ if and (eq $index 0) (eq $paginator.PageNumber 1) }}
                <img src="{{ $desktopImg.RelPermalink }}" srcset="{{ $mobileImg.RelPermalink }} 800w, {{ $desktopImg.RelPermalink }} 1200w" sizes="(max-width: 768px) 100vw, 100vw" width="{{ $desktopImg.Width }}" height="{{ $desktopImg.Height }}" alt="{{ $element.Title }}" class="w-full h-full object-cover" fetchpriority="high" loading="eager" />
            {{ else }}
                <img src="{{ $mobileImg.RelPermalink }}" class="md:hidden w-full h-full object-cover" alt="{{ $element.Title }}" loading="lazy" />
                <img src="{{ $desktopImg.RelPermalink }}" class="hidden md:block w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="{{ $element.Title }}" loading="lazy" />
            {{ end }} 
        {{ else }}
            <div class="w-full h-full bg-slate-200 flex items-center justify-center text-slate-400">No Image</div>
        {{ end }}

        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent md:hidden pointer-events-none"></div>
        <div class="hidden md:block absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"></div>
      </div>

      <div class="relative z-10 p-8 pb-24 md:p-0 md:mt-6">
        <div class="flex items-center gap-3 mb-3">
          <span class="px-3 py-1 text-[10px] font-bold uppercase tracking-widest bg-brand text-white rounded-full shadow-lg md:shadow-none">
            {{ with $element.Params.categories }}{{ index . 0 }}{{ else }}News{{ end }}
          </span>
          <span class="text-xs font-medium text-gray-300 md:text-gray-500 uppercase">
            {{ $element.Date.Format "Jan 02, 2006" }}
          </span>
        </div>

        <h2 class="text-3xl md:text-2xl font-black leading-tight mb-3 text-white md:text-text-main drop-shadow-md md:drop-shadow-none group-hover:text-brand transition-colors">
          <a href="{{ $element.RelPermalink }}"> {{ $element.Title }} </a>
        </h2>

        <p class="text-gray-100 drop-shadow-md md:text-text-body md:drop-shadow-none text-sm md:text-base leading-relaxed line-clamp-3 mb-6 md:line-clamp-3">
          {{ $element.Summary | plainify }}
        </p>

        <a href="{{ $element.RelPermalink }}" class="hidden md:inline-flex items-center text-sm font-bold text-brand hover:text-brand-dark uppercase tracking-wide">
          Read the article
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 ml-1">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>
      <a href="{{ $element.RelPermalink }}" class="absolute inset-0 z-20 md:hidden" aria-label="Read article"></a>
    </article>

    {{ $freq := site.Params.interscroller.frequency | default 5 }}
    
    {{ if eq (mod (add $index 1) $freq) 0 }}
        {{ $pageSize := 15 }}
        {{ $offset := mul (sub $paginator.PageNumber 1) $pageSize }}
        {{ $absoluteIndex := add $offset $index }}
        {{ $breakNumber := div (add $absoluteIndex 1) $freq }} 
        {{ $sectionsCount := len site.Params.interscroller.sections }}
        {{ $sectionIndex := mod (sub $breakNumber 1) $sectionsCount }}
        {{ $currentSection := index site.Params.interscroller.sections $sectionIndex }}

        {{ partial "components/interscroller.html" $currentSection }}
    {{ end }}

    {{ end }} 
  </div> {{ if $paginator.HasNext }}
  <div class="w-full h-screen snap-start shrink-0 bg-gray-100 flex flex-col items-center justify-center p-6 md:h-auto md:bg-transparent md:py-12 md:block md:col-span-full md:max-w-7xl md:mx-auto md:px-6">
      
      <a href="{{ $paginator.Next.URL }}" class="group flex flex-col items-center gap-4 text-center md:inline-flex md:flex-row md:justify-center md:w-full md:bg-gray-50 md:py-8 md:rounded-xl md:hover:bg-gray-100 md:transition-colors">
          <div class="w-20 h-20 rounded-full border-4 border-brand flex items-center justify-center text-brand group-hover:bg-brand group-hover:text-white transition-all duration-300 md:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="size-8 animate-bounce">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
            </svg>
          </div>
          <div>
              <span class="block text-2xl font-black text-gray-900 uppercase md:hidden">Continue reading</span>
              <span class="text-gray-600 text-sm md:hidden">Load next articles</span>
              <span class="hidden md:inline-block bg-brand text-white font-bold uppercase px-8 py-3 rounded-full hover:bg-gray-900 transition-colors">
                  Load more articles
              </span>
          </div>
      </a>
  </div>
  {{ end }}

  {{ if not $paginator.HasNext }}
    {{ partial "footer.html" . }}
  {{ end }}

</div>
{{ end }}