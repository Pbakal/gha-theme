<meta charset="utf-8" />

{{/* --- 1. GESTIONE TITOLO OTTIMIZZATA --- */}}
<title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>

{{ partial "schema.html" . }}

{{/* --- 2. CALCOLO UNICO DELLA DESCRIZIONE --- */}}
{{ $siteDesc := "" }}
{{ if .IsPage }}
    {{ $siteDesc = .Summary }}
{{ else }}
    {{ if .Site.Params.description }}
        {{ $siteDesc = .Site.Params.description }}
    {{ else }}
        {{ $siteDesc = printf "Ultime notizie, politica e aggiornamenti sportivi da %s, %s. Leggi le news locali di %s su %s." .Site.Params.city .Site.Params.country .Site.Params.region .Site.Title }}
    {{ end }}
{{ end }}

{{/* --- 3. META TAG GENERALI --- */}}
<meta name="description" content="{{ $siteDesc }}">
<meta name="author" content="{{ .Site.Title }}">

{{/* Open Graph Base */}}
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ .Title }}">
<meta property="og:description" content="{{ $siteDesc }}">
<meta property="og:site_name" content="{{ .Site.Title }}">

{{/* Twitter Card Base */}}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ .Title }}">
<meta name="twitter:description" content="{{ $siteDesc }}">

{{/* --- 4. GESTIONE IMMAGINI SOCIAL (LOGICA SMART) --- */}}
{{ $ogImage := "" }}
{{ $imgResource := "" }}

{{/* A. Cerchiamo l'immagine con priorità a cascata */}}

{{/* 1. Controllo Frontmatter (Se hai messo image: "foto.jpg") */}}
{{ with .Params.image }}
  {{ $imgResource = $.Resources.GetMatch . }}
{{ end }}

{{/* 2. Controllo Pattern Automatici (Se c'è un file chiamato cover.jpg, main.png, ecc.) */}}
{{ if not $imgResource }}
  {{ $imgResource = .Resources.GetMatch .Site.Params.images.priority_pattern }}
{{ end }}

{{/* 3. Fallback (Prendi la prima immagine che trovi nell'articolo) */}}
{{ if not $imgResource }}
  {{ $imgResource = .Resources.GetMatch .Site.Params.images.fallback_pattern }}
{{ end }}

{{/* B. Se abbiamo trovato un'immagine, la processiamo per i Social (1200x630) */}}
{{ with $imgResource }}
    {{/* Fill ritaglia esattamente al centro. WebP per leggerezza. */}}
    {{ $socialImg := .Fill "1200x630 center webp q80" }}
    {{ $ogImage = $socialImg.Permalink }}
{{ end }}

{{/* C. Fallback Globale (Per la Home o se l'articolo non ha foto) */}}
{{ if eq $ogImage "" }}
    {{/* USIAMO IL NUOVO LOGO UFFICIALE! */}}
    {{ $ogImage = absURL "/images/social-cover.jpg" }} 
{{ end }}

{{/* D. Stampiamo finalmente i tag immagine */}}
<meta property="og:image" content="{{ $ogImage }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:image" content="{{ $ogImage }}">


{{/* --- 5. FAVICONS & THEME COLOR --- */}}
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">

<link rel="manifest" href="/favicon/site.webmanifest?v=2">
<link rel="shortcut icon" href="/favicon/favicon.ico">

<meta name="theme-color" content="{{ .Site.Params.themeColor | default "#e11d48" }}">
<meta name="msapplication-TileColor" content="{{ .Site.Params.themeColor | default "#e11d48" }}">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">