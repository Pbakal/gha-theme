<meta charset="utf-8" />

{{/* --- 1. GESTIONE TITOLO OTTIMIZZATA --- */}}
{{/* In Home mostra solo il nome sito, nelle altre pagine "Titolo Pagina | Nome Sito" */}}
<title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>

{{ partial "schema.html" . }}

{{/* --- 2. CALCOLO UNICO DELLA DESCRIZIONE --- */}}
{{/* Calcoliamo la descrizione UNA volta sola e la salviamo nella variabile $siteDesc */}}
{{ $siteDesc := "" }}

{{ if .IsPage }}
    {{/* Se è un articolo, usa il sommario */}}
    {{ $siteDesc = .Summary }}
{{ else }}
    {{/* Se è la Home o una lista */}}
    {{ if .Site.Params.description }}
        {{ $siteDesc = .Site.Params.description }}
    {{ else }}
        {{/* Fallback dinamico se manca la descrizione nel config */}}
        {{ $siteDesc = printf "Ultime notizie, politica e aggiornamenti sportivi da %s, %s. Leggi le news locali di %s su %s." .Site.Params.city .Site.Params.country .Site.Params.region .Site.Title }}
    {{ end }}
{{ end }}

{{/* --- 3. META TAG (Stampati una volta sola usando la variabile) --- */}}
<meta name="description" content="{{ $siteDesc }}">
<meta name="author" content="{{ .Site.Title }}">

{{/* Open Graph (Facebook/Social) */}}
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ .Title }}">
<meta property="og:description" content="{{ $siteDesc }}">
<meta property="og:site_name" content="{{ .Site.Title }}">

{{/* Twitter Card */}}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ .Title }}">
<meta name="twitter:description" content="{{ $siteDesc }}">

{{/* --- 4. GESTIONE IMMAGINI SOCIAL --- */}}
{{ $ogImage := "" }}

{{/* Cerchiamo l'immagine */}}
{{ $imgResource := .Resources.GetMatch "*{jpg,jpeg,png,webp}" }}

{{ with $imgResource }}
    {{/* Creiamo versione 1200x630 ottimizzata */}}
    {{ $socialImg := .Fill "1200x630 center" }}
    {{ $ogImage = $socialImg.Permalink }}
{{ end }}

{{/* Se l'abbiamo trovata, stampiamo i tag immagine */}}
{{ if ne $ogImage "" }}
    <meta property="og:image" content="{{ $ogImage }}">
    <meta name="twitter:image" content="{{ $ogImage }}">
{{ end }}

{{/* --- 5. FAVICONS & THEME COLOR --- */}}
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">

{{/* Aggiungo la query string ?v=2 per forzare l'aggiornamento del manifest */}}
<link rel="manifest" href="/favicon/site.webmanifest?v=2">
<link rel="shortcut icon" href="/favicon/favicon.ico">

{{/* Qui sta la correzione principale: leggo la variabile e metto un fallback di sicurezza */}}
<meta name="theme-color" content="{{ .Site.Params.themeColor | default "#e11d48" }}">
<meta name="msapplication-TileColor" content="{{ .Site.Params.themeColor | default "#e11d48" }}">

{{/* Questo è utile per la barra di stato su iPhone */}}
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
