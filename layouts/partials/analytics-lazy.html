<script>
    (function() {
        const gaId = '{{ .Site.Config.Services.GoogleAnalytics.ID }}';
        let scriptLoaded = false;

        function loadGA() {
            if (scriptLoaded) return;
            scriptLoaded = true;

            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=' + gaId;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', gaId, { 'anonymize_ip': true });

            console.log('GA4 Caricato (Lazy)');
        }

        // Carica solo dopo interazione utente O dopo 4 secondi
        const events = ['mousedown', 'mousemove', 'keydown', 'scroll', 'touchstart'];
        events.forEach(event => document.addEventListener(event, loadGA, { once: true, passive: true }));
        
        // Fallback: carica comunque dopo 4 secondi se l'utente Ã¨ immobile
        setTimeout(loadGA, 4000);
    })();
</script>