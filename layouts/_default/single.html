{{ define "main" }}

<article class="pt-24 pb-20">
  <header class="max-w-4xl mx-auto px-6 mb-12 text-center">
    <div class="flex items-center justify-center gap-4 mb-6">
      <span
        class="px-3 py-1 text-xs font-bold uppercase tracking-widest text-brand bg-red-100 rounded-full"
      >
        {{ with .Params.categories }}{{ index . 0 }}{{ else }}News{{ end }}
      </span>
      <time class="text-sm text-gray-500 font-medium uppercase"
        >{{ .Date.Format "Jan 02, 2006" }}</time
      >
    </div>

    <h1
      class="text-4xl md:text-5xl lg:text-6xl font-black text-text-main leading-tight mb-8"
    >
      {{ .Title }}
    </h1>

    {{/* 1. Cerchiamo l'immagine prima di aprire qualsiasi DIV */}}
{{ $imgResource := .Resources.GetMatch .Site.Params.images.priority_pattern }}
{{ if not $imgResource }}
    {{ $imgResource = .Resources.GetMatch .Site.Params.images.fallback_pattern }}
{{ end }}

{{/* 2. Usiamo 'with': tutto ciò che è qui dentro appare SOLO se $imgResource esiste */}}
{{ with $imgResource }}
<div class="relative w-full aspect-video rounded-2xl overflow-hidden shadow-2xl mb-12">
    
    {{/* Qui siamo sicuri che l'immagine c'è, procediamo col rendering */}}
    {{ $mobileImg := .Fill "800x1200 webp center" }}
    {{ $desktopImg := .Fill "1200x675 webp center" }}
    
    <img 
        src="{{ $desktopImg.RelPermalink }}" 
        srcset="{{ $mobileImg.RelPermalink }} 800w, {{ $desktopImg.RelPermalink }} 1200w" 
        sizes="(max-width: 768px) 100vw, 1200px"
        alt="{{ $.Title }}"
        width="{{ $desktopImg.Width }}"
        height="{{ $desktopImg.Height }}"
        class="w-full h-full object-cover"
        fetchpriority="high" 
        loading="eager"
    >
</div>
{{ end }}
  </header>

  <div class="max-w-3xl mx-auto px-6">
    <div
      class="prose prose-lg prose-slate mx-auto text-text-body first-letter:text-5xl first-letter:font-bold first-letter:text-brand first-letter:mr-3 first-letter:float-left"
    >
      {{ .Content }}
    </div>

    <div class="max-w-3xl mx-auto px-6">
        {{ partial "share-buttons.html" . }}
        {{ partial "author-box.html" . }}
    </div>
    
    {{ if eq .Type "posts" }}
        {{ partial "related.html" . }}
    {{ end }}

    
  </div>
</article>

{{ end }}
